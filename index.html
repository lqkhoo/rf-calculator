<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-16"/>
        <!--
        <link rel="stylesheet" href="css/bootstrap-5.1.0.min.css"/>
        -->
        <link rel="stylesheet" href="css/jquery-ui.min.css"/>
        <link rel="stylesheet" href="css/knockout-autocomplete.css"/>
        <link rel="stylesheet" href="css/rf5planner.css"/>
        <!-- <script type="text/javascript" src="js/lib/requirejs-2.3.6-min.js"></script> -->
        <script type="text/javascript" src="js/lib/jquery-1.11.2.min.js"></script>
        <script type="text/javascript" src="js/rf5planner.js"></script>
        <script type="text/javascript" src="js/lib/jquery-ui-1.11.0.min.js"></script>
        <script type="text/javascript" src="js/lib/jquery-ui-autocomplete-extension.js"></script>
        <script type="text/javascript" src="js/modified-knockout-jqueryui.js"></script>
        <!--
        <script type="text/javascript" src="js/lib/knockout-autocomplete.js"></script>
        -->
        
    </head>
    <body>

        <nav class="navbar navbar-default">
            <div class="container">
                <table>
                    <tbody>
                        <tr>
                            <td rowspan="2"><h4 class="title">Rune Factory 5 Gear Calculator</h4></td>
                            <td>
                                <div class="form-check form-switch">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" data-bind="checked: IsEnglishSelected"/>
                                        Show English
                                    </label>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="form-check form-switch">
                                    <label class="form-check-label">
                                        <input class="form-check-input" type="checkbox" data-bind="checked: IsJapaneseSelected"/>
                                        Show Japanese
                                    </label>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <!-- Binding context window.RF5Planner -->
                <ul id="character-tabs" class="nav nav-tabs" data-bind="foreach: { data: CharacterList }" role="tablist" >
                    <!-- ko let: { characterIdx: $index(), RF5Character: $data } -->
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" data-bind="attr: { 'data-bs-target': '#character-'+ characterIdx }" data-bs-toggle="tab" role="tab">
                                <img class="icon" data-bind="attr: { src: image_uri() }"/>
                            </button>
                        </li>
                        <!-- ko if: ($index() === ($parent.CharacterList().length-1)) -->
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" data-bind="click: $root.AddCharacter">+</button>
                            </li>
                        <!-- /ko -->
                    <!-- /ko -->
                </ul>
            </div>
        </nav>

        <main id="main" class="container" data-bind="css: { 'lang_en': IsEnglishSelected(), 'lang_jp': IsJapaneseSelected() }">
            
            <!-- Binding context indow.RF5Planner -->
            <div id="character-tab-pages" class="tab-content" data-bind="foreach: { data: CharacterList }">
                <!-- ko let: { characterIdx: $index(), RF5Character: $data } -->
                <div class="tab-pane fade" data-bind="attr: { id: 'character-' + $index() }" role="tab-panel">
                    <table class="table table-bordered stats-table">
                        <thead>
                            <tr>
                                <th rowspan="3"><div class="dummy-header" data-bind="template: { name: 'TEMPLATE-character-icon-group' }"></div></th>
                                <th rowspan="2" colspan="2"></th>
                                <th colspan="19"><span class="lang jp">攻</span><span>&nbsp;&nbsp;</span><span class="lang en">OFFENSE</span></th>
                                <th colspan="20"><span class="lang jp">防</span><span>&nbsp;&nbsp;</span><span class="lang en">DEFENSE</span></th>
                                <th colspan="2" rowspan="2"></th>
                            </tr>
                            <tr>
                                <th colspan="7"><span class="lang en jp">STAT</span></th>
                                <th colspan="12"><span class="lang jp">状態</span><span>&nbsp;&nbsp;&nbsp;</span><span class="lang en">STATUS</span></th>
                                <th colspan="8"><span class="lang jp">属性</span><span>&nbsp;&nbsp;&nbsp;</span><span class="lang en">ELE</span></th>
                                <th colspan="12" class="box-shadow-override"><span class="lang jp">状態</span><span>&nbsp;&nbsp;&nbsp;</span><span class="lang en">STATUS</span></th>

                            </tr>
                            <tr>
                                <th><span class="lang stack jp">総</span><span class="lang stack en">LVL</span></th>
                                <th><span class="lang stack jp">素</span><span class="lang stack en">RAR</span></th>
                                <th class="wide"><span class="lang stack en jp">ATK</span></th>
                                <th class="wide"><span class="lang stack en jp">DEF</span></th>
                                <th class="wide"><span class="lang stack en jp">MAT</span></th>
                                <th class="wide"><span class="lang stack en jp">MDF</span></th>
                                <th class="wide"><span class="lang stack en jp">STR</span></th>
                                <th class="wide"><span class="lang stack en jp">INT</span></th>
                                <th class="wide"><span class="lang stack en jp">VIT</span></th>
                                <th><span class="lang stack jp">DIZ</span><span class="lang stack en">DIZ</span></th>
                                <th><span class="lang stack jp">CRT</span><span class="lang stack en">CRT</span></th>
                                <th><span class="lang stack jp">飛</span><span class="lang stack en">KNO</span></th>
                                <th><span class="lang stack jp">ス</span><span class="lang stack en">STN</span></th>
                                <th><span class="lang stack jp">毒</span><span class="lang stack en">PSN</span></th>
                                <th><span class="lang stack jp">封</span><span class="lang stack en">SEA</span></th>
                                <th><span class="lang stack jp">麻</span><span class="lang stack en">PAR</span></th>
                                <th><span class="lang stack jp">睡</span><span class="lang stack en">SLP</span></th>
                                <th><span class="lang stack jp">疲</span><span class="lang stack en">FTG</span></th>
                                <th><span class="lang stack jp">病</span><span class="lang stack en">SCK</span></th>
                                <th><span class="lang stack jp">気</span><span class="lang stack en">FNT</span></th>
                                <th><span class="lang stack jp">吸</span><span class="lang stack en">DRN</span></th>
                                <th><span class="lang stack jp">火</span><span class="lang stack en">FIR</span></th>
                                <th><span class="lang stack jp">水</span><span class="lang stack en">WTR</span></th>
                                <th><span class="lang stack jp">地</span><span class="lang stack en">EAR</span></th>
                                <th><span class="lang stack jp">風</span><span class="lang stack en">WND</span></th>
                                <th><span class="lang stack jp">光</span><span class="lang stack en">LGT</span></th>
                                <th><span class="lang stack jp">闇</span><span class="lang stack en">DRK</span></th>
                                <th><span class="lang stack jp">愛</span><span class="lang stack en">LOV</span></th>
                                <th><span class="lang stack jp">無</span><span class="lang stack en">NUL</span></th>
                                <th><span class="lang stack jp">DIZ</span><span class="lang stack en">DIZ</span></th>
                                <th><span class="lang stack jp">CRT</span><span class="lang stack en">CRT</span></th>
                                <th><span class="lang stack jp">飛</span><span class="lang stack en">KNO</span></th>
                                <th><span class="lang stack jp">ス</span><span class="lang stack en">STN</span></th>
                                <th><span class="lang stack jp">毒</span><span class="lang stack en">PSN</span></th>
                                <th><span class="lang stack jp">封</span><span class="lang stack en">SEA</span></th>
                                <th><span class="lang stack jp">麻</span><span class="lang stack en">PAR</span></th>
                                <th><span class="lang stack jp">睡</span><span class="lang stack en">SLP</span></th>
                                <th><span class="lang stack jp">疲</span><span class="lang stack en">FTG</span></th>
                                <th><span class="lang stack jp">病</span><span class="lang stack en">SCK</span></th>
                                <th><span class="lang stack jp">気</span><span class="lang stack en">FNT</span></th>
                                <th><span class="lang stack jp">吸</span><span class="lang stack en">DRN</span></th>
                                <th><span class="lang stack jp">速</span><span class="lang stack en">CHG</span></th>
                                <th><span class="lang stack jp">長</span><span class="lang stack en">LNG</span></th>

                            </tr>
                            <!-- ko template: { name: 'TEMPLATE-character-upper' } --><!-- /ko -->
                        </thead>
                        <tbody>
                            <!-- ko template: { name: 'TEMPLATE-character-lower', data: RF5Character } --><!-- /ko -->
                            
                            <!-- ko let: { equipmentType: 'weapon' } -->
                                <!-- ko template: { name: 'TEMPLATE-group-header', data: { model: $data, name_en: 'Weapons', name_jp: '\u6b66\u5668' } } --><!-- /ko -->
                                <!-- ko foreach: Weapons() -->
                                    <!-- ko template: { name: 'TEMPLATE-weapon' }--><!-- /ko -->
                                <!-- /ko -->
                                <!-- ko template: { name: 'TEMPLATE-group-footer' } --><!-- /ko -->
                            <!-- /ko -->

                            <!-- ko let: { equipmentType: 'shield' } -->
                            <!-- ko template: { name: 'TEMPLATE-group-header', data: { model: $data, name_en: 'Shields', name_jp: '\u76fe' } } --><!-- /ko -->
                            <!-- ko foreach: Shields() -->
                                <!-- ko template: { name: 'TEMPLATE-shield' }--><!-- /ko -->
                            <!-- /ko -->
                            <!-- ko template: { name: 'TEMPLATE-group-footer' } --><!-- /ko -->
                            <!-- /ko -->

                            <!-- ko let: { equipmentType: 'headgear' } -->
                                <!-- ko template: { name: 'TEMPLATE-group-header', data: { model: $data, name_en: 'Headgears', name_jp: '\u982d\u88c5\u5099' } } --><!-- /ko -->
                                <!-- ko foreach: Headgears() -->
                                    <!-- ko template: { name: 'TEMPLATE-headgear' }--><!-- /ko -->
                                <!-- /ko -->
                                <!-- ko template: { name: 'TEMPLATE-group-footer' } --><!-- /ko -->
                            <!-- /ko -->

                            <!-- ko let: { equipmentType: 'armor' } -->
                                <!-- ko template: { name: 'TEMPLATE-group-header', data: { model: $data, name_en: 'Armor', name_jp: '\u4f53\u88c5\u5099' } } --><!-- /ko -->
                                <!-- ko foreach: Armors() -->
                                    <!-- ko template: { name: 'TEMPLATE-armor' }--><!-- /ko -->
                                <!-- /ko -->
                                <!-- ko template: { name: 'TEMPLATE-group-footer' } --><!-- /ko -->
                            <!-- /ko -->

                            <!-- ko let: { equipmentType: 'boots' } -->
                                <!-- ko template: { name: 'TEMPLATE-group-header', data: { model: $data, name_en: 'Boots', name_jp: '\u8db3\u88c5\u5099' } } --><!-- /ko -->
                                <!-- ko foreach: Boots() -->
                                    <!-- ko template: { name: 'TEMPLATE-boots' }--><!-- /ko -->
                                <!-- /ko -->
                                <!-- ko template: { name: 'TEMPLATE-group-footer' } --><!-- /ko -->
                            <!-- /ko -->

                            <!-- ko let: { equipmentType: 'accessory' } -->
                                <!-- ko template: { name: 'TEMPLATE-group-header', data: { model: $data, name_en: 'Accessories', name_jp: '\u30a2\u30af\u30bb\u30b5\u30ea\u30fc' } } --><!-- /ko -->
                                <!-- ko foreach: Accessories() -->
                                    <!-- ko template: { name: 'TEMPLATE-accessory' }--><!-- /ko -->
                                <!-- /ko -->
                                <!-- ko template: { name: 'TEMPLATE-group-footer' } --><!-- /ko -->
                            <!-- /ko -->

                        </tbody>
                    </table>
                </div>
                <!-- /ko -->
            </div>
        </main>

        <script type="text/javascript" src="js/lib/bootstrap-5.1.0.bundle.js"></script>
        <!--
        <script type="text/javascript" src="js/lib/bootstrap-5.1.0.bundle.min.js"></script>
        <script type="text/javascript" src="js/lib/bootstrap-5.1.0.bundle.min.js.map"></script>
        -->
        
    </body>

    <!-- ================================== Character templates =============================== -->

    <script type="text/html" id="TEMPLATE-character-icon-group">
        <label class="icon-group character">
            <table>
                <tbody>
                    <tr>
                        <td class="icon-td"><img data-bind="attr: { src: image_uri() }"/></td>
                        <td>
                            <span class="lang jp" data-bind="text: name_jp()"></span>
                            <span class="lang en" data-bind="text: name_en()"></span>
                        </td>
                        <td class="icon-td">
                            <input type="text" data-bind="autocomplete: { source: ViewModel.GetSearchStrings(), html: 'html', minLength: 0, select: RF5Character.ViewModel.AutoCompleteSelectHandler }, value: RF5Character.id()">
                        </td>
                    </tr>
                </tbody>
            </table>
        </label>
    </script>

    <script type="text/html" id="TEMPLATE-character-upper">
        <tr>
            <th>Total</th>
            <th colspan="43"></th>
        </tr>
    </script>

    <script type="text/html" id="TEMPLATE-character-lower">
        <tr>
            <td>General's set bonus</td>
        </tr>
        <tr>
            <td>Clover bonus</td>
        </tr>
        <tr>
            <td>Happy ring bonus</td>
        </tr>
        <tr>
            <td>Rare can bonus</td>
        </tr>
    </script>

    <!-- =========================================== Item group templates ====================================== -->

    <!-- Context RF5Item -->
    <script type="text/html" id="TEMPLATE-header-icon-group">
        <div class="icon-group" data-bind="class: $data.EquipmentType">
            <input type="checkbox" data-bind="checked: IsActive(), click: Character().ViewModel.OnEquipmentRadioClickHandler.bind(event, equipmentType, $index())"/>
            <!--
                <button class="btn collapsed" data-bs-toggle="collapse" data-bind="attr: { 'data-bs-target': '.char-'+ characterIdx +'-'+ equipmentType +'-'+ equipmentIdx }, class: 'char-'+ characterIdx +'-'+ equipmentType +'-toggler'">
            -->
            <button class="btn" data-bind="css: { collapsed: $data.ViewModel.IsCollapsed() }, click: $data.ViewModel.OnGroupHeaderClickHandler.bind(event)">
                <table>
                    <tbody>
                        <tr>
                            <td class="icon-td"><img class="icon" data-bind="attr: { src: $data.BaseItem().image_uri }"/></td>
                            <td>
                                <span class="lang jp" data-bind="text: $data.BaseItem().name_jp"></span>
                                <span class="lang en" data-bind="text: $data.BaseItem().name_en"></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </button>
        </div>
    </script>


    <!-- Context { model: RF5Character, name_en: str, name_jp: str } -->
    <script type="text/html" id="TEMPLATE-group-header">
        <tr>
            <td style="background-color: #dddddd;">
                <button class="group-header btn" data-bind="css: { collapsed: model.ViewModel.IsItemGroupCollapsed[equipmentType]() }, click: model.ViewModel.OnGroupHeaderClickHandler.bind(event, equipmentType)">
                    <span class="lang jp" data-bind="text: name_jp"></span>
                    <span class="lang en" data-bind="text: name_en"></span>
                </button>
            </td>
            <td colspan="43" style="background-color: #dddddd;">foobar</td>
        </tr>
    </script>

    <!-- Context RF5Character -->
    <script type="text/html" id="TEMPLATE-group-footer">
        <tr class="collapse" data-bind="css: { show: ! $data.ViewModel.IsItemGroupCollapsed[equipmentType]() }">
            <td><Button class="btn" data-bind="click: $data.ViewModel.OnAddItemClickHandler.bind(event, equipmentType)">+</Button></td>
        </tr>
    </script>



    <!-- Mostly text-replace for 'weapon', 'shield', 'headgear', 'armor', 'boots', 'accessories' -->

    <script type="text/html" id="TEMPLATE-weapon">
        <tr class="collapse" data-bind="css: { show: !ViewModel.IsCollapsed() }">
            <td data-bind="template: { name: 'TEMPLATE-header-icon-group' }"></td>
            <!-- ko template: { name: 'TEMPLATE-stats', data: $data } --><!-- /ko -->
        </tr>
        <!-- ko template: { name: 'TEMPLATE-rarity-lvl-slots' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-weapon-element-slot' }--><!-- /ko -->
        <!-- ko if: $root.Data.IsStaff($data.id()) -->
            <!-- ko template: { name: 'TEMPLATE-staff-spell-slots' } --><!-- /ko -->
        <!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-clover-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-rarecan-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-scrapmetalplus-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-equipment-slots' } --><!-- /ko -->
    </script>

    <script type="text/html" id="TEMPLATE-shield">
        <tr class="collapse" data-bind="css: { show: !ViewModel.IsCollapsed() }">
            <td data-bind="template: { name: 'TEMPLATE-header-icon-group' }"></td>
            <!-- ko template: { name: 'TEMPLATE-stats', data: $data } --><!-- /ko -->
        </tr>
        <!-- ko template: { name: 'TEMPLATE-rarity-lvl-slots' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-hastruescale-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-shieldstatmultiplier-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-corebonus-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-clover-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-equipment-slots' } --><!-- /ko -->
    </script>

    <script type="text/html" id="TEMPLATE-headgear">
        <tr class="collapse" data-bind="css: { show: !ViewModel.IsCollapsed() }">
            <td data-bind="template: { name: 'TEMPLATE-header-icon-group' }"></td>
            <!-- ko template: { name: 'TEMPLATE-stats', data: $data } --><!-- /ko -->
        </tr>
        <!-- ko template: { name: 'TEMPLATE-rarity-lvl-slots' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-clover-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-corebonus-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-equipment-slots' } --><!-- /ko -->
    </script>

    <script type="text/html" id="TEMPLATE-armor">
        <tr class="collapse" data-bind="css: { show: !ViewModel.IsCollapsed() }">
            <td data-bind="template: { name: 'TEMPLATE-header-icon-group' }"></td>
            <!-- ko template: { name: 'TEMPLATE-stats', data: $data } --><!-- /ko -->
        </tr>
        <!-- ko template: { name: 'TEMPLATE-rarity-lvl-slots' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-clover-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-corebonus-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-equipment-slots' } --><!-- /ko -->
    </script>

    <script type="text/html" id="TEMPLATE-boots">
        <tr class="collapse" data-bind="css: { show: !ViewModel.IsCollapsed() }">
            <td data-bind="template: { name: 'TEMPLATE-header-icon-group' }"></td>
            <!-- ko template: { name: 'TEMPLATE-stats', data: $data } --><!-- /ko -->
        </tr>
        <!-- ko template: { name: 'TEMPLATE-rarity-lvl-slots' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-clover-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-corebonus-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-equipment-slots' } --><!-- /ko -->
    </script>

    <script type="text/html" id="TEMPLATE-accessory">
        <tr class="collapse" data-bind="css: { show: !ViewModel.IsCollapsed() }">
            <td data-bind="template: { name: 'TEMPLATE-header-icon-group' }"></td>
            <!-- ko template: { name: 'TEMPLATE-stats', data: $data } --><!-- /ko -->
        </tr>
        <!-- ko template: { name: 'TEMPLATE-rarity-lvl-slots' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-clover-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-corebonus-slot' }--><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-equipment-slots' } --><!-- /ko -->
    </script>

    <!-- ================================= Slot templates ================================= -->

    <!-- Context RF5Item -->
    <!-- For collapsible support, we just piggyback onto BaseItem's ViewModel, so we don't need yet another viewmodel -->
    <script type="text/html" id="TEMPLATE-rarity-lvl-slots">
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">総Lvボーナス</span>
                &nbsp;<span class="lang en">Level bonus</span>
            </td>
            <!-- ko template: { name: 'TEMPLATE-stats', data: $data.LevelBonus() } --><!-- /ko -->
        </tr>
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">素Lvボーナス</span>
                &nbsp;<span class="lang en">Rarity bonus</span>
                <span class="badge" data-bind="text: $data.RarityBonus().RarityStatType()"></span>
            </td>
            <!-- ko template: { name: 'TEMPLATE-stats', data: $data.RarityBonus() } --><!-- /ko -->
        </tr>
    </script>

    <script type="text/html" id="TEMPLATE-clover-slot">
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">クローバー</span>
                &nbsp;<span class="lang en">Clover</span>
                <span class="badge" data-bind="text: $data.HasClover()"></span>
            </td>
            <!-- ko template: 'TEMPLATE-stats-empty' --><!-- /ko -->
        </tr>
    </script>

    <script type="text/html" id="TEMPLATE-rarecan-slot">
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">レアなあきかん</span>
                &nbsp;<span class="lang en">Rare Can</span>
                <span class="badge" data-bind="text: $data.HasRareCan()"></span>
            </td>
            <!-- ko template: 'TEMPLATE-stats-empty' --><!-- /ko -->
        </tr>
    </script>

    <script type="text/html" id="TEMPLATE-scrapmetalplus-slot">
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">すごいクズ鉄</span>
                &nbsp;<span class="lang en">Scrap Metal+</span>
                <span class="badge" data-bind="text: $data.HasScrapMetalPlus()"></span>
            </td>
            <!-- ko template: 'TEMPLATE-stats-empty' --><!-- /ko -->
        </tr>
    </script>

    <script type="text/html" id="TEMPLATE-hastruescale-slot">
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">ウロコある</span>
                &nbsp;<span class="lang en">Has scale effect</span>
                <span class="badge" data-bind="text: $data.HasTrueScale()"></span>
            </td>
            <!-- ko template: 'TEMPLATE-stats-empty' --><!-- /ko -->
        </tr>
    </script>

    <script type="text/html" id="TEMPLATE-weapon-element-slot">
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">属性</span>
                &nbsp;<span class="lang en">Element</span>
                <span class="badge" data-bind="text: $data.Element()"></span>
            </td>
            <!-- ko template: 'TEMPLATE-stats-empty' --><!-- /ko -->
        </tr>
    </script>

    <script type="text/html" id="TEMPLATE-shieldstatmultiplier-slot">
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">STAT倍数</span>
                &nbsp;<span class="lang en">STAT multiplier</span>
                <span class="badge" data-bind="text: $data.ShieldStatMultiplier() + 'x'"></span>
            </td>
            <!-- ko template: 'TEMPLATE-stats-empty' --><!-- /ko -->
        </tr>
    </script>

    <script type="text/html" id="TEMPLATE-corebonus-slot">
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">四つのコア</span>
                &nbsp;<span class="lang en">4x Core bonus</span>
                <span class="badge" data-bind="text: $data.CoreBonus().HasCoreBonus()"></span>
            </td>
            <!-- ko template: { name: 'TEMPLATE-stats', data: $data.CoreBonus() } --><!-- /ko -->
        </tr>
    </script>

    <script type="text/html" id="TEMPLATE-staff-spell-slots">
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">魔法Lv1</span>
                &nbsp;<span class="lang en">MagicLv1</span>
                <span class="badge" data-bind="text: $data.MagicIdCharge1Name()"></span>
            </td>
            <!-- ko template: 'TEMPLATE-stats-empty' --><!-- /ko -->
        </tr>
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">魔法Lv2</span>
                &nbsp;<span class="lang en">MagicLv2</span>
                <span class="badge" data-bind="text: $data.MagicIdCharge2Name()"></span>
            </td>
            <!-- ko template: 'TEMPLATE-stats-empty' --><!-- /ko -->
        </tr>
        <tr class="collapse subslot" data-bind="css: { show: ! BaseItem().ViewModel.IsCollapsed() }">
            <td>
                <span class="lang jp">魔法Lv3</span>
                &nbsp;<span class="lang en">MagicLv3</span>
                <span class="badge" data-bind="text: $data.MagicIdCharge3Name()"></span>
            </td>
            <!-- ko template: 'TEMPLATE-stats-empty' --><!-- /ko -->
        </tr>
    </script>



    <script type="text/html" id="TEMPLATE-equipment-slots">
        <!-- ko template: { name: 'TEMPLATE-slot', data: BaseItem() }--><!-- /ko -->
        <!-- ko foreach: { data: RecipeSlots } -->
            <!-- ko template: 'TEMPLATE-slot-editable-level' --><!-- /ko -->
        <!-- /ko -->
        <!-- ko foreach: { data: ArrangeSlots } -->
            <!-- ko template: 'TEMPLATE-slot' --><!-- /ko -->
        <!-- /ko -->
        <!-- ko foreach: { data: UpgradeSlots } -->
            <!-- ko template: 'TEMPLATE-slot-editable-level' --><!-- /ko -->
        <!-- /ko -->
    </script>

    <!-- Context RF5Slot -->
    <script type="text/html" id="TEMPLATE-slot-header">
        <td>
            <label class="icon-group small" data-bind="class: Item().EquipmentType">
                <table>
                    <tbody>
                        <tr>
                            <td>
                                <button class="btn detail-button" data-bind="click: ViewModel.DetailButtonClickHandler">
                                    <span data-bind="text: ViewModel.SlotName(), css: { displayNone: ViewModel.IsRestricted() }"></span>
                                    <img class="icon-lock" data-bind="attr: { src: 'bootstrap-icons/file-lock2.svg'}, css: { displayNone: ! ViewModel.IsRestricted() }"/>
                                </button>
                            </td>
                            <td class="icon-td"><img class="icon small" data-bind="attr: { src: image_uri }"/></td>
                            <td>
                                <span class="lang jp" data-bind="text: name_jp"></span>
                                <span class="lang en" data-bind="text: name_en"></span>
                            </td>
                            <td>
                                <input type="text" data-bind="attr: { disabled: ViewModel.IsLocked() }, autocomplete: { source: ViewModel.GetSearchStrings(), html: 'html', minLength: 0, select: ViewModel.AutoCompleteSelectHandler }, value: id()">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </label>
        </td>
    </script>

    <script type="text/html" id="TEMPLATE-slot-footer">
        <!-- Expanded tooltips. All display conditions are AND-based, so most of them should short-circuit by the first id or index check. -->
        <tr class="collapse" data-bind="css: { show: ! ViewModel.IsCollapsed() }">
            <td colspan="44">

                <!-- Context: RF5Slot -->
                <!-- Arrange start: 7. Upgrade start: 10 -->
                <div class="detail-panel"><!-- Always display warnings -->

                    <!-- ko if: $root.Data.IsEquipment(id()) && HasPrecedingOverrider() -->
                        <!-- ko template: { name: 'TEMPLATE-detail-warn', data: { text_en: 'No effect! Only one item can override.', text_jp: '効果がありません。性能継承アレンジは、一つのアイテムの性能しか継承出来ません。' } } --><!-- /ko -->
                    <!-- /ko -->

                    <!-- ko if: (Index !== 0 && Index < 7) && $root.Data.IsEquipment(id()) && (! IsOverriding()) && (! HasPrecedingOverrider()) -->
                        <!-- ko template: { name: 'TEMPLATE-detail-warn', data: { text_en: 'No effect! Only items of same type can override. Overriding a weapon of different type requires Light Ore in any recipe slot.', text_jp: '効果がありません。性能継承アレンジは、ベースと同じ種類のアイテムが必要です。別のカテゴリの武器の場合なら、レシピにメッシライト鉱石も必要です。' } } --><!-- /ko -->
                    <!-- /ko -->

                    <!-- ko if: (Index >= 10) && $root.Data.IsEquipment(id())  -->
                        <!-- ko template: { name: 'TEMPLATE-detail-warn', data: { text_en: 'Equipment in upgrade slots only contributes to item level! (Farm equipment contributes rarity)', text_jp: '強化枠に入った装備は総Lv以外のパラメーターがカウントしません。（農用装備の素材Lvカウントします）' } } --><!-- /ko -->
                    <!-- /ko -->

                    <!-- ko if: (Index < 11) && ($root.Data.Is2foldSteel(id()) || $root.Data.Is10foldSteel(id()))  -->
                        <!-- ko template: { name: 'TEMPLATE-detail-warn', data: { text_en: 'No effect! Fold steel requires preceding item in upgrade slot.', text_jp: '効果がありません。倍鉄は強化枠にあるアイテム以外に対象外です。' } } --><!-- /ko -->
                    <!-- /ko -->

                    <!-- ko if: (Index >= 11) && ( ($root.Data.Is2foldSteel(id()) && ! IsEffective2FoldSteel()) || ($root.Data.Is10foldSteel(id()) && ! IsEffective10FoldSteel()) )-->
                        <!-- ko template: { name: 'TEMPLATE-detail-warn', data: { text_en: 'No effect! Only one fold steel (of each type) per item.', text_jp: '効果がありません。一つのアイテムにつき一つのみ有効。' } } --><!-- /ko -->
                    <!-- /ko -->


                </div>
                <div class="detail-panel" data-bind="css: { displayNone: ViewModel.AreDetailsCollapsed() }">
                    <!-- ko if: (Index === 0) && (id() !== 0) -->
                        <!-- ko template: { name: 'TEMPLATE-detail-info', data: { text_en: 'Base item lvl and rarity is always zero.', text_jp: '強化されているアイテムの素材Lvと総Lvは必ずゼロになります。' } } --><!-- /ko -->
                    <!-- /ko -->
                    <!-- ko if: (Index === 0) && (id() !== 0) && IsBeingOverridden() -->
                        <!-- ko template: { name: 'TEMPLATE-detail-info', data: { text_en: 'Item being overridden. All parameters become zero.', text_jp: '性能継承発生中。全パラメーターゼロになります。' } } --><!-- /ko -->
                    <!-- /ko -->
                    <!-- ko if: (Index < 7) && ViewModel.IsRestricted() -->
                        <!-- ko template: { name: 'TEMPLATE-detail-info', data: { text_en: 'Slot being restricted by recipe.', text_jp: '本枠はレシピにより制限されています。' } } --><!-- /ko -->
                    <!-- /ko -->

                    <!-- ko if: IsOverriding() -->
                        <!-- ko template: { name: 'TEMPLATE-detail-info', data: { text_en: 'Item overriding base. All parameters in full effect.', text_jp: '性能継承発生中。全パラメーター代用されています。' } } --><!-- /ko -->
                    <!-- /ko -->
                    <!-- ko if: (Index !== 0) && (id() !== 0) && (Index < 7) && ! $root.Data.IsEquipment(id()) -->
                        <!-- ko template: { name: 'TEMPLATE-detail-info', data: { text_en: 'Materials in recipe slots only apply rarity and level bonuses.', text_jp: 'レシピに使った素材（アレンジ外れ素材）は総Lvと素材Lv以外の効果がありません。' } } --><!-- /ko -->
                    <!-- /ko -->
                    <!-- ko if: (7 <= Index) &&  (Index < 10) && (id() !== 0) -->
                        <!-- ko template: { name: 'TEMPLATE-detail-info', data: { text_en: 'Materials in arrange slots do not apply level bonus.', text_jp: 'アレンジ素材のLvはアイテムの総Lvにカウントしません。' } } --><!-- /ko -->
                    <!-- /ko -->

                    <!-- ko if: (Index >= 11) && ($root.Data.Is2foldSteel(id()) || $root.Data.Is10foldSteel(id()))  -->
                        <!-- ko template: { name: 'TEMPLATE-detail-info', data: { text_en: 'Fold steel directly multiplies preceding item parameters. Ignores ObjectX and diminishing returns.', text_jp: '倍鉄は物体Xの効果と半減効果が無視して、一つ前の素材本来のパラメーター直接に乗算します。' } } --><!-- /ko -->
                    <!-- /ko -->
                    <!-- ko if: (Index >= 7) && $root.Data.IsObjectX(id()) -->
                        <!-- ko template: { name: 'TEMPLATE-detail-info', data: { text_en: 'Object X inverts all following item parameters, until another Object X. Effect carries over from arrange slots.', text_jp: '物体Xは後の素材のパラメーター反転します。その反転効果はアレンジ枠から引き続き出来ます。' } } --><!-- /ko -->
                    <!-- /ko -->

                    <!-- ko if: (Index >= 7) && (Item().EquipmentType === "shield") && $root.Data.IsScale(id()) && ($root.Data.IsTrueScale(id())) -->
                        <!-- ko template: { name: 'TEMPLATE-detail-info', data: { text_en: 'Wet/Hard/Mermaid scale will not apply scale bonus.', text_jp: '湿った/固い/人魚のうろこは盾の倍数に効果がありません。' } } --><!-- /ko -->
                    <!-- /ko -->

                </div>
            </td>
        </tr>
    </script>


    <script type="text/html" id="TEMPLATE-slot">
        <tr class="collapse" data-bind="css: { show: ! ViewModel.IsCollapsed() }">
            <!-- ko template: 'TEMPLATE-slot-header' --><!-- /ko -->
            <!-- ko template: 'TEMPLATE-stats' --><!-- /ko -->
        </tr>
        <!-- ko template: 'TEMPLATE-slot-footer' --><!-- /ko -->
    </script>

    <script type="text/html" id="TEMPLATE-slot-editable-level">
        <tr class="collapse" data-bind="css: { show: ! ViewModel.IsCollapsed() }">
            <!-- ko template: { name: 'TEMPLATE-slot-header', data: $data } --><!-- /ko -->
            <!-- ko template: { name: 'TEMPLATE-stats-editable-level', data: $data } --><!-- /ko -->
        </tr>
        <!-- ko template: { name: 'TEMPLATE-slot-footer', data: $data } --><!-- /ko -->
    </script>


    <script type="text/html" id="TEMPLATE-stats-base">
        
        <!-- ko template: { name: 'TEMPLATE-cell', data: rarity() } --><!-- /ko -->

        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_ATK() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_DEF() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_MAT() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_MDF() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_STR() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_INT() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_VIT() } --><!-- /ko -->

        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_DIZ() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_CRT() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_KNO() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_STN() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_PSN() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_SEA() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_PAR() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_SLP() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_FTG() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_SCK() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_FNT() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_atk_DRN() } --><!-- /ko -->

        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_ele_FIRE() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_ele_WATER() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_ele_EARTH() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_ele_WIND() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_ele_LIGHT() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_ele_DARK() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_ele_LOVE() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_ele_VOID() } --><!-- /ko -->

        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_DIZ() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_CRT() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_KNO() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_STN() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_PSN() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_SEA() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_PAR() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_SLP() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_FTG() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_SCK() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_FNT() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_def_DRN() } --><!-- /ko -->

        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_chargespeed() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-cell', data: stat_attacklength() } --><!-- /ko -->
    </script>

    <script type="text/html" id="TEMPLATE-stats-editable-level">
        <!--
        <td><input type="number" data-bind="value: level()" /></td>
        -->
        <td>
            <select data-bind="value: LevelOverride, options: ViewModel.LevelOptions"></select>
        </td>
        <!-- ko template: { name: 'TEMPLATE-stats-base', data: $data } -->
    </script>

    <script type="text/html" id="TEMPLATE-stats">
        <!-- ko template: { name: 'TEMPLATE-cell', data: level() } --><!-- /ko -->
        <!-- ko template: { name: 'TEMPLATE-stats-base', data: $data } -->
    </script>

    <script type="text/html" id="TEMPLATE-stats-empty">
        <!-- 43 cells -->
        <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
        <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
        <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
        <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
        <td></td><td></td><td></td>
    </script>

    <script type="text/html" id="TEMPLATE-cell">
        <!-- ko if: $data === 0 -->
            <td></td>
        <!-- /ko -->
        <!-- ko ifnot: $data === 0 -->
            <td data-bind="text: $data"></td>
        <!-- /ko -->
    </script>

    <script type="text/html" id="TEMPLATE-detail-info">
        <span>
            <img src="bootstrap-icons/info-circle.svg"/>
            <span class="lang jp" ><span data-bind="text: text_jp"></span></span>
            <span class="lang en"><span data-bind="text: text_en"></span></span>
        </span>
    </script>

    <script type="text/html" id="TEMPLATE-detail-warn">
        <span>
            <img src="bootstrap-icons/exclamation-triangle.svg"/>
            <span class="lang jp" ><span data-bind="text: text_jp"></span></span>
            <span class="lang en"><span data-bind="text: text_en"></span></span>
        </span>
    </script>


</html>